version: 2

models:
  - name: stg_yelp_restaurants
    description: "Cleaned and standardized Yelp restaurant data"
    columns:
      - name: restaurant_id
        description: "Unique identifier for restaurant"
        tests:
          - unique
          - not_null
      - name: restaurant_name
        tests:
          - not_null
      - name: latitude
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 42.2
              max_value: 42.5
      - name: longitude
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -71.2
              max_value: -70.9
      - name: yelp_rating
        tests:
          - dbt_utils.accepted_range:
              min_value: 1.0
              max_value: 5.0
              inclusive: true
              
  - name: stg_health_inspections
    description: "Cleaned Boston health inspection data"
    columns:
      - name: inspection_id
        tests:
          - unique
          - not_null
      - name: license_no
        tests:
          - not_null

  - name: stg_cambridge_inspections
    description: "Cleaned Cambridge sanitary inspection data"
    columns:
      - name: inspection_id
        description: "Case number from Cambridge system"
        tests:
          - not_null
      - name: establishment_name
        tests:
          - not_null
      - name: latitude
        tests:
          - not_null
      - name: longitude
        tests:
          - not_null
      - name: violation_severity
        tests:
          - accepted_values:
              values: ['HIGH', 'MEDIUM', 'LOW']
      - name: data_source
        tests:
          - accepted_values:
              values: ['CAMBRIDGE']

  - name: stg_mbta_stops
    columns:
      - name: stop_id
        tests:
          - unique
          - not_null

  - name: stg_mbta_routes
    columns:
      - name: route_id
        tests:
          - unique
          - not_null

  - name: stg_google_places
    description: "Cleaned Google Places enrichment data with dietary, accessibility, and service options"
    columns:
      - name: restaurant_id
        description: "Foreign key to restaurants"
        tests:
          - not_null
          - relationships:
              to: ref('stg_yelp_restaurants')
              field: restaurant_id
      
      - name: google_place_id
        description: "Unique Google Places identifier"
        tests:
          - unique
          - not_null
      
      - name: business_status
        description: "Operating status from Google"
        tests:
          - accepted_values:
              values: ['OPERATIONAL', 'CLOSED_TEMPORARILY', 'CLOSED_PERMANENTLY', null]
      
      - name: is_operational
        description: "Boolean flag for operational status"
        tests:
          - not_null
      
      - name: serves_vegetarian
        description: "Boolean indicating vegetarian food availability"
        tests:
          - not_null
      
      - name: good_for_groups
        description: "Boolean indicating suitability for groups"
        tests:
          - not_null
      
      - name: is_wheelchair_accessible
        description: "Comprehensive accessibility flag"
        tests:
          - not_null